# SyncKit Stress Test Client - Fly.io Configuration
# 48-day production stress test (runs 24/7)

app = "synckit-stress-test-client"
primary_region = "sjc"  # San Jose, CA

# Build configuration
[build]
  dockerfile = "Dockerfile"

# Environment variables
[env]
  NODE_ENV = "production"
  METRICS_DIR = "/app/metrics"

# HTTP service (for health checks)
[[services]]
  internal_port = 8080
  protocol = "tcp"

  # Keep client running continuously
  auto_stop_machines = false
  auto_start_machines = true
  min_machines_running = 1

  # Health check endpoint (optional - we'll add a simple HTTP server)
  [[services.http_checks]]
    interval = "60s"
    timeout = "10s"
    grace_period = "30s"
    method = "GET"
    path = "/health"
    protocol = "http"

  # HTTP handlers
  [[services.ports]]
    handlers = ["http"]
    port = 80

# Resource allocation - minimal for cost efficiency
[vm]
  cpu_kind = "shared"
  cpus = 1
  memory_mb = 256  # Tiny machine, just for stress testing

# Persistent storage for metrics
[mounts]
  source = "stress_test_metrics"
  destination = "/app/metrics"

# Deploy command:
# cd stress-test/client-node
# fly apps create synckit-stress-test-client --region sjc
# fly volumes create stress_test_metrics --region sjc --size 1
# fly secrets set SERVER_URL=wss://synckit-stress-test.fly.dev
# fly deploy
