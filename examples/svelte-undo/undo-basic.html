<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Svelte Undo/Redo - Basic Example</title>
  <script defer src="https://unpkg.com/svelte@4/compiler.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #ff3e00 0%, #ff8a00 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 600px;
      width: 100%;
    }

    h1 {
      font-size: 28px;
      margin-bottom: 10px;
      color: #1a202c;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .svelte-logo {
      color: #ff3e00;
    }

    .subtitle {
      color: #718096;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .editor {
      margin-bottom: 30px;
    }

    textarea {
      width: 100%;
      min-height: 200px;
      padding: 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 14px;
      resize: vertical;
      transition: border-color 0.2s;
    }

    textarea:focus {
      outline: none;
      border-color: #ff3e00;
    }

    .controls {
      display: flex;
      gap: 12px;
      margin-bottom: 30px;
    }

    button {
      flex: 1;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-undo {
      background: #ff3e00;
      color: white;
    }

    .btn-undo:not(:disabled):hover {
      background: #e63900;
      transform: translateY(-1px);
    }

    .btn-redo {
      background: #ff8a00;
      color: white;
    }

    .btn-redo:not(:disabled):hover {
      background: #e67a00;
      transform: translateY(-1px);
    }

    .btn-clear {
      background: #f56565;
      color: white;
    }

    .btn-clear:not(:disabled):hover {
      background: #e53e3e;
      transform: translateY(-1px);
    }

    .info {
      background: #f7fafc;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #e2e8f0;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-label {
      font-size: 13px;
      color: #718096;
      font-weight: 500;
    }

    .info-value {
      font-size: 14px;
      color: #2d3748;
      font-weight: 600;
    }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-success {
      background: #c6f6d5;
      color: #22543d;
    }

    .badge-error {
      background: #fed7d7;
      color: #742a2a;
    }

    .history {
      background: #f7fafc;
      border-radius: 8px;
      padding: 20px;
      max-height: 200px;
      overflow-y: auto;
    }

    .history h3 {
      font-size: 14px;
      color: #2d3748;
      margin-bottom: 12px;
    }

    .history-item {
      padding: 8px 12px;
      background: white;
      border-radius: 4px;
      margin-bottom: 6px;
      font-size: 12px;
      color: #4a5568;
      font-family: 'Monaco', monospace;
    }

    .history-empty {
      text-align: center;
      color: #a0aec0;
      font-size: 13px;
      padding: 20px;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="module">
    import { writable, derived } from 'https://unpkg.com/svelte@4/store/index.mjs';

    // Simple inline Svelte component using vanilla JS
    class UndoRedoApp {
      constructor(target) {
        this.text = '';
        this.undoStack = [];
        this.redoStack = [];
        this.operationCount = 0;
        this.target = target;

        this.render();
        this.attachEventListeners();
      }

      get canUndo() {
        return this.undoStack.length > 0;
      }

      get canRedo() {
        return this.redoStack.length > 0;
      }

      get recentOperations() {
        return this.undoStack.slice(-5).reverse();
      }

      handleTextChange(event) {
        const newText = event.target.value;
        const oldText = this.text;

        this.undoStack.push({
          type: 'text-change',
          data: { from: oldText, to: newText },
          timestamp: Date.now()
        });

        this.redoStack = [];
        this.text = newText;
        this.operationCount++;
        this.render();
      }

      undo() {
        if (this.undoStack.length === 0) return;

        const operation = this.undoStack.pop();
        this.redoStack.push(operation);
        this.text = operation.data.from;
        this.render();
      }

      redo() {
        if (this.redoStack.length === 0) return;

        const operation = this.redoStack.pop();
        this.undoStack.push(operation);
        this.text = operation.data.to;
        this.render();
      }

      clear() {
        this.undoStack = [];
        this.redoStack = [];
        this.text = '';
        this.operationCount = 0;
        this.render();
      }

      handleKeyDown(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
          e.preventDefault();
          if (this.canUndo) this.undo();
        } else if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) {
          e.preventDefault();
          if (this.canRedo) this.redo();
        }
      }

      attachEventListeners() {
        this.keyDownHandler = this.handleKeyDown.bind(this);
        window.addEventListener('keydown', this.keyDownHandler);
      }

      destroy() {
        window.removeEventListener('keydown', this.keyDownHandler);
      }

      render() {
        this.target.innerHTML = `
          <div class="container">
            <h1>
              <span class="svelte-logo">ðŸ”¥</span>
              Svelte Undo/Redo
            </h1>
            <p class="subtitle">
              Try typing, then use Ctrl+Z to undo and Ctrl+Y to redo
            </p>

            <div class="editor">
              <textarea
                id="editor-textarea"
                placeholder="Start typing to create undo history..."
              >${this.text}</textarea>
            </div>

            <div class="controls">
              <button
                class="btn-undo"
                id="undo-btn"
                ${!this.canUndo ? 'disabled' : ''}
              >
                â†¶ Undo (Ctrl+Z)
              </button>
              <button
                class="btn-redo"
                id="redo-btn"
                ${!this.canRedo ? 'disabled' : ''}
              >
                â†· Redo (Ctrl+Y)
              </button>
              <button class="btn-clear" id="clear-btn">
                Clear All
              </button>
            </div>

            <div class="info">
              <div class="info-row">
                <span class="info-label">Operations</span>
                <span class="info-value">${this.operationCount}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Undo Stack</span>
                <span class="info-value">${this.undoStack.length}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Redo Stack</span>
                <span class="info-value">${this.redoStack.length}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Can Undo</span>
                <span class="badge ${this.canUndo ? 'badge-success' : 'badge-error'}">
                  ${this.canUndo ? 'Yes' : 'No'}
                </span>
              </div>
              <div class="info-row">
                <span class="info-label">Can Redo</span>
                <span class="badge ${this.canRedo ? 'badge-success' : 'badge-error'}">
                  ${this.canRedo ? 'Yes' : 'No'}
                </span>
              </div>
            </div>

            <div class="history">
              <h3>Recent Operations</h3>
              ${this.recentOperations.length === 0 ?
                '<div class="history-empty">No operations yet</div>' :
                this.recentOperations.map(op => `
                  <div class="history-item">
                    ${op.type}: ${op.data.to.substring(0, 30)}${op.data.to.length > 30 ? '...' : ''}
                  </div>
                `).join('')
              }
            </div>
          </div>
        `;

        // Re-attach event listeners after render
        const textarea = document.getElementById('editor-textarea');
        const undoBtn = document.getElementById('undo-btn');
        const redoBtn = document.getElementById('redo-btn');
        const clearBtn = document.getElementById('clear-btn');

        if (textarea) {
          textarea.addEventListener('input', this.handleTextChange.bind(this));
        }
        if (undoBtn) {
          undoBtn.addEventListener('click', () => this.undo());
        }
        if (redoBtn) {
          redoBtn.addEventListener('click', () => this.redo());
        }
        if (clearBtn) {
          clearBtn.addEventListener('click', () => this.clear());
        }
      }
    }

    // Initialize app
    const app = new UndoRedoApp(document.getElementById('app'));
  </script>
</body>
</html>
